#!/bin/bash

echo "Checking CONTRIBUTOR status..."
echo "(specifically in these commits:"
git log --pretty=format:' %aE' ${TRAVIS_COMMIT_RANGE}
echo " ...)"
echo

failed=''
for x in $(git log --pretty=format:'%aE|%h - %s (%aN <%aE>)' ${TRAVIS_COMMIT_RANGE}); do
	email=${x##|*}
	desc=${x%*|}
	echo "checking ${desc}"
	if grep -q '^[^#].*<'${email}'>' allowed; then
		echo "$desc ... OK"
	else
		echo "<${email}> not found in allowed contributors:"
		echo "$desc ... FAILED"
		failed='y'
	fi
done

if [[ -z ${failed} ]]; then
	echo "CLA found!"
	exit 0
fi

echo "No CLA found... :sadpanda:"
exit 1
